<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BillBot - Bills Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bills.css') }}">
</head>
<body>
    {% include 'sidebar.html' %}
    <main class="main-content p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Bills Management</h1>
        <p class="text-gray-600 mb-8">View and track all your upcoming and past bill payments.</p>
        <div class="card p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Upcoming Bills Summary</h2>
                <button id="toggleAdd" class="px-3 py-1 bg-[#38A169] text-white rounded">+ Add Bill</button>
            </div>

            <form id="addBillForm" class="space-y-4 mb-6 hidden" method="post" action="/bills/create">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Name</label>
                        <input name="name" required class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Amount</label>
                        <input name="amount" required type="number" step="0.01" class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tag</label>
                        <select name="tag" class="w-full p-2 border rounded">
                            <option value="">Select a category</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="groceries">Groceries</option>
                            <option value="rent">Rent</option>
                            <option value="electricity">Electricity</option>
                            <option value="water">Water</option>
                            <option value="gas">Gas</option>
                            <option value="internet">Internet</option>
                            <option value="phone">Phone</option>
                            <option value="insurance">Insurance</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="education">Education</option>
                            <option value="transportation">Transportation</option>
                            <option value="dining">Dining</option>
                            <option value="shopping">Shopping</option>
                            <option value="subscriptions">Subscriptions</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Payment Mode</label>
                        <input name="payment_mode" class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Period</label>
                        <select name="period" class="w-full p-2 border rounded">
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                            <option value="one-time">One-time</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">First Payment Date</label>
                        <input name="first_payment_date" type="date" class="w-full p-2 border rounded" />
                        <p class="text-xs text-gray-500 mt-1">The date you first paid this bill. We'll calculate future due dates automatically.</p>
                    </div>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="px-4 py-2 bg-[#38A169] text-white rounded">Create</button>
                </div>
            <form id="editBillForm" class="space-y-4 mb-6 hidden bg-yellow-50 p-4 rounded-lg border border-yellow-200" method="post" action="">
                <h4 class="font-semibold text-gray-800">Edit Bill</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Name</label>
                        <input name="name" id="editName" required class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <input name="description" id="editDescription" class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Amount</label>
                        <input name="amount" id="editAmount" required type="number" step="0.01" class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tag</label>
                        <select name="tag" id="editTag" class="w-full p-2 border rounded">
                            <option value="">Select a category</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="groceries">Groceries</option>
                            <option value="rent">Rent</option>
                            <option value="electricity">Electricity</option>
                            <option value="water">Water</option>
                            <option value="gas">Gas</option>
                            <option value="internet">Internet</option>
                            <option value="phone">Phone</option>
                            <option value="insurance">Insurance</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="education">Education</option>
                            <option value="transportation">Transportation</option>
                            <option value="dining">Dining</option>
                            <option value="shopping">Shopping</option>
                            <option value="subscriptions">Subscriptions</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Payment Mode</label>
                        <input name="payment_mode" id="editPaymentMode" class="w-full p-2 border rounded" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Period</label>
                        <select name="period" id="editPeriod" class="w-full p-2 border rounded">
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                            <option value="one-time">One-time</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">First Payment Date</label>
                        <input name="first_payment_date" id="editFirstPaymentDate" type="date" class="w-full p-2 border rounded" />
                        <p class="text-xs text-gray-500 mt-1">The date you first paid this bill. We'll calculate future due dates automatically.</p>
                    </div>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancelEdit" class="px-4 py-2 text-gray-600 border rounded hover:bg-gray-50 transition">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">Update</button>
                </div>
            </form>
            <ul class="space-y-3">
                {% for bill in bills %}
                <li class="flex justify-between p-4 border-b items-center bg-white rounded-lg shadow-sm">
                    <div class="flex-1">
                        <div class="font-medium text-lg">{{ bill.name }}</div>
                        <div class="text-sm text-gray-500">{{ bill.description or '' }}</div>
                        <div class="text-xs text-gray-400 mt-1">
                            <span class="inline-block bg-gray-100 px-2 py-1 rounded mr-2">{{ bill.tag or 'No category' }}</span>
                            <span class="inline-block bg-blue-100 px-2 py-1 rounded mr-2">{{ bill.payment_mode or '—' }}</span>
                            <span class="inline-block bg-green-100 px-2 py-1 rounded">{{ bill.period or '—' }}</span>
                        </div>
                    </div>
                    <div class="text-right flex items-center space-x-3">
                        <div>
                            <div class="text-red-500 font-bold text-xl">${{ '%.2f' % (bill.amount_cents / 100) }}</div>
                            <div class="text-sm text-gray-500">
                                {% if bill.next_due %}
                                    Due: {{ bill.next_due.strftime('%b %d, %Y') }}
                                {% else %}
                                    No due date
                                {% endif %}
                            </div>
                        </div>
                        <div class="flex flex-col space-y-1">
                            <button data-bill-id="{{ bill.id }}" data-bill-name="{{ bill.name }}" data-bill-description="{{ bill.description or '' }}" data-bill-tag="{{ bill.tag or '' }}" data-bill-payment-mode="{{ bill.payment_mode or '' }}" data-bill-amount="{{ '%.2f' % (bill.amount_cents / 100) }}" data-bill-period="{{ bill.period or '' }}" data-bill-last-paid="{{ bill.last_paid.strftime('%Y-%m-%d') if bill.last_paid else '' }}" class="edit-bill-btn px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition">Edit</button>
                            <form method="post" action="/bills/{{ bill.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this bill?')" class="inline">
                                <button type="submit" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition">Delete</button>
                            </form>
                        </div>
                    </div>
                </li>
                {% else %}
                <li class="p-4 text-gray-500 text-center bg-gray-50 rounded-lg">No bills yet. Add one using the + button above.</li>
                {% endfor %}
            </ul>
        </div>
    </main>
    <script>
        document.getElementById('toggleAdd').addEventListener('click', () => {
            const f = document.getElementById('addBillForm');
            f.classList.toggle('hidden');
        });

        // Handle edit bill buttons
        document.querySelectorAll('.edit-bill-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const billId = btn.dataset.billId;
                const name = btn.dataset.billName;
                const description = btn.dataset.billDescription;
                const tag = btn.dataset.billTag;
                const paymentMode = btn.dataset.billPaymentMode;
                const amount = btn.dataset.billAmount;
                const period = btn.dataset.billPeriod;
                const lastPaid = btn.dataset.billLastPaid;

                // Populate edit form
                document.getElementById('editName').value = name;
                document.getElementById('editDescription').value = description;
                document.getElementById('editAmount').value = amount;
                document.getElementById('editTag').value = tag;
                document.getElementById('editPaymentMode').value = paymentMode;
                document.getElementById('editPeriod').value = period;
                document.getElementById('editFirstPaymentDate').value = lastPaid;

                // Set form action
                document.getElementById('editBillForm').action = `/bills/${billId}/edit`;

                // Show edit form and hide add form
                document.getElementById('editBillForm').classList.remove('hidden');
                document.getElementById('addBillForm').classList.add('hidden');

                // Scroll to edit form
                document.getElementById('editBillForm').scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Handle cancel edit
        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editBillForm').classList.add('hidden');
        });
    </script>
</body>
</html>